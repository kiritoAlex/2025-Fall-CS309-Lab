# Tutorial Week 2

## 传统LLM的局限性

- 无法感知外部环境
- 无法有效处理复杂任务（环环相扣的任务）
- 知识库具有滞后性

Agent可以很好地解决这些问题！

![image.png](Tutorial%20Week%202%2026d5da91858180289756f36c8f22431f/image.png)

## Agent运行模式

## 1. ReAct（Reasoning and Acting）

该框架由Princeton与Google Brain团队提出，发表在ICLR 2023

[ReACT: Synergizing Reasoning and Acting in Language Models](https://openreview.net/pdf?id=WE_vluYUL-X)

该框架旨在让大语言模型（LLMs）在完成任务时能够同时进行“推理（Reasoning）”和“行动（Acting）”，以弥补传统仅推理或仅行动方法的不足。通过交替生成思维链条和任务行为，ReAct 模式在多个任务上实现了更高的准确率与更强的泛化能力，同时提升了解释性与可控性。

### 1.1 ReAct架构

![image.png](Tutorial%20Week%202%2026d5da91858180289756f36c8f22431f/image%201.png)

### 1.2 How to design Prompt to let LLM learn how to call tools?

**XML（Extensible Markup Language）**

XML是一种标记语言，用于规范化存储和传输数据，具有较强的可扩展性（你可以定义自己的标签），并且方便解析

```jsx
<?xml version="1.0" encoding="UTF-8"?>
<students>
    <student id="1">
        <name>Alice</name>
        <age>20</age>
    </student>
    <student id="2">
        <name>Bob</name>
        <age>22</age>
    </student>
</students>
```

在ReAct模式中，我们主要用到五种自定义的xml标签，用于约束Agent的数据传递格式

```
- <question> 用户问题
- <thought> 思考
- <action> 采取的工具操作
- <observation> 工具或环境返回的结果
- <final_answer> 最终答案
```

示例说明（埃菲尔铁塔有多高？）

```python
<question>埃菲尔铁塔有多高？</question>
<thought>我需要找到埃菲尔铁塔的高度。可以使用搜索工具。</thought>
<action>get_height("埃菲尔铁塔")</action>
<observation>埃菲尔铁塔的高度约为330米（包含天线）。</observation>
<thought>搜索结果显示了高度。我已经得到答案了。</thought>
<final_answer>埃菲尔铁塔的高度约为330米。</final_answer>
```

### 1.3 ReAct运行时序图

![image.png](Tutorial%20Week%202%2026d5da91858180289756f36c8f22431f/image%202.png)

## 2. Plan-And-Execute

Plan-and-Execute 就是把规划和执行解耦，避免 LLM 在长任务中丢失上下文或走偏。

![image.png](Tutorial%20Week%202%2026d5da91858180289756f36c8f22431f/image%203.png)

### 2.1 A simple case

- **Plan（规划）**
    - Agent 首先根据用户需求，生成一个完整的 **计划（Plan）**，通常是多个子任务的序列。
    - 例如：
        
        > 用户问：帮我写一篇关于「AI 在教育中的应用」的文章
        > 
        > 
        > 计划：
        > 
        > 1. 搜集 AI 在教育中的最新研究资料
        > 2. 总结常见应用场景
        > 3. 讨论优缺点
        > 4. 生成文章草稿
- **Execute（执行）**
    - Agent 按照计划逐步执行子任务。
    - 每个子任务可能会调用工具（搜索 API、数据库、计算器等），也可能再调用 LLM。
    - 执行过程中可记录结果，最后整合输出。

### 2.2 Plan-and-Execute 的优点

- **结构化**：相比 ReAct，不会因为长对话而「迷路」，更适合复杂任务。
- **可控性**：你可以审查或修改计划，再交给 Agent 执行。
- **可扩展**：不同角色的 Agent 可以负责不同部分（比如一个 Planner Agent，一个 Executor Agent）。
- **减少 Token 消耗**：规划一次，执行多步时可以只传递子任务上下文。

### 2.3 ReAct与Plan-and-Execute的比较

| 特性 | ReAct | Plan-and-Execute |
| --- | --- | --- |
| 思考方式 | 每一步思考+行动交替 | 先生成全局计划，再执行 |
| 适合场景 | 短任务，探索式任务 | 长任务，多步骤任务，结构化任务 |
| 上下文压力 | 高（LLM 每次要看全部历史） | 低（执行时只需看局部任务） |
| 可控性 | 较低 | 高（计划可审查/修改） |

## 练习：第一个Agent Application（ReAct）

```jsx
//Clone the repository
git clone https://github.com/kiritoAlex/2025-Fall-CS309-Lab.git

//Create a new conda environment
conda create -n cs309 python=3.10 

//Enter conda environment
conda activate cs309

//Install necessary packages
pip install openai tiktoken python-dotenv requests click

cd week2

python agent.py snake
```